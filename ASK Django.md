# ASK Django

## 1
### PG(이니시스)
* 지원 샘플: ASP, ASP.NET, PHP, JSP
* 이니시스 웹 연동 메뉴얼을 보면 된다.
* 그 외 여러 pg사들은 거의 10년 전에 만든 ASP/PHP/JSP 샘플만 제공한다.

### 해외는 Stripe
가볍고 빠르게 적용할 수 있는 결제 서비스

### 국내에는 아임포트가 있다.
* 아임포트가 각 pg사들에 대한 Gateway
* 즉 단일 api로 국내 수많은 pg사들을 커버한다.
* 개발환경에 중립적이다.
* JavaScript 코드 하나로 PC/Mobile/In-APP 결제 모두 지원
* 플랫폼 별로 약간의 추가 셋업이 필요하긴 합니다.
* 카드사가 요구하는 결제 프로세스를 100% 준수

### 아임포트, 서비스 비용
#### 기본기능에 대해서는 무료!
* 1개 PG사 연동
* 기본 관리자 대시보드
* 기본 기능 사용 제약 없음

#### 유료부분
* 2개 이상 PG사 연동(최초 1회만 10만원)
* 결제 데이터 분석(월 39,000원)


### 단계1)인증
1. 구매자는 카드사 웹페이지를 통해 카드번호/유효기간/비밀번호를 입력하여 카드확인
 * 이때 카드정보의 보호를 위해 별도의 프로그램 설치요구...
2. 카드정보가 확인되면, 카드사는 1회성 인증키를 PG사에 제공되며, 이 인증키가 실제 결제에 사용

### 단계2)결제
##### 가맹점 서버오 PG사 서버 간 통신
1. 가맹점 서버: 인증단계에서 사용된 주문번호, 구매자 연락처 등의 정보를 PG사 서버로 전송
2. PG사는 카드사로부터 전달된 인증키와 함께 해당 카드사로 승인요청을 진행
 * 이 과정에서 실제 카드사로부터 결제 승인에 대한 결과를 알 수 있습니다. 결제 승인 혹은 결제실패(한도초과/분실카드 등의 사유)가 판단 됩니다.

### 안심클릭/ISP결제모듈

* 안심클릭: 카드번호, cvc, 안심클릭 비밀본호를 입력하여 카드정보를 인증
 * 별도의 앱이 필요없기 때문에 모바일 브라webview 앱결제가 동일한 처리
* ISP: 공개키 기반의 전자인증서를 통해 사전에 등록된 카드정보를 인증
 * ISP앱 설치/인증서 복사를 요구
 * ISP를 거쳤다가, 다시 원래 결제 프로세스로 이동 
 * 다시 앱으로 돌아오기 위해, URL Scheme 정의/처리가 필요.
 * `http://`로 요청이오면 웹요청이구나 판단을 해서 띄워 주는것 이런 정의를 해주어야지 결제가 완료된 후 다시 원래 페이지로 돌아올 수 있다.

### 비인증결제
* key-in결제: 전화를 통한 비대면 상황에서 카드정보 + 개인정보를 활요해 결제
* 빌링결제: 정기결제

### 아임포트가 Dirty Process를 대신 수행한다.
* 개발자는 아임포트가 제공하는 표준화된 API로 간편히 연동.
 * PG창 결제창 호출 -> 결제 결과 수신
 * 결제 조회/검증(REST API)

### 방어적으로 코딩하기
* "결제 프로세스 상 금액정보가 사용자에 의해 변경되어 시작될 수 있는 가능성이 있습니다."
* "가맹졈 서버"단에서 결제정보 조회 API를 통한 체크가 필수!!!


